<template>
  <div class="testUser">
    <el-row :gutter="20" class="userTitle">
      <el-col :span="3"><span>用户名</span></el-col>
      <el-col :span="3"><span>姓名</span></el-col>
      <el-col :span="3"><span>注册时间</span></el-col>
      <el-col :span="5"><span>描述</span></el-col>
      <el-col :span="5"><span>地址</span></el-col>
      <el-col :span="5"><span>选择角色</span></el-col>
    </el-row>
    <el-row :gutter="20"
    :key="user"
    v-for="(user, index) in userlist" class="userlist">
      <el-col :span="3"><span>{{user.username}}&nbsp;</span></el-col>
      <el-col :span="3"><span>{{user.name}}&nbsp;</span></el-col>
      <el-col :span="3"><span>{{user.date | date}}&nbsp;</span></el-col>
      <el-col :span="5"><span>{{user.describes}}&nbsp;</span></el-col>
      <el-col :span="5"><span>{{user.address}}&nbsp;</span></el-col>
      <el-col :span="5">
        <el-select v-model="user.roleName" placeholder="请选择" @change="setrole(user.id, user.roleName)">
          <el-option
            :key="item"
            v-for="item in options"
            :label="item.name"
            :value="item.id">
          </el-option>
        </el-select>
      </el-col>
    </el-row>
    <div class="block" v-if="userArgs.totalPage > 1">
      <el-pagination
        @current-change="currentPageChange"
        :current-page.sync="userArgs.currentPage"
        layout="total, prev, pager, next"
        :page-count="userArgs.totalPage">
      </el-pagination>
    </div>
  </div>
</template>

<script>
import axios from 'axios'
import global from '../../global/global'
export default {
  data () {
    return {
      value: '',
      options: [],
      userlist: null,
      userArgs: {
        currentPage: 1,
        numberPerPage: 10,
        totalPage: -1,
        token: global.getToken()
      }
    }
  },
  created () {
    this.getUserList(this.userArgs)
    var self = this
    axios.post(global.baseUrl + 'role/list?token=' + global.getToken())
    .then((res) => {
      // console.log(res)
      self.options = res.data.data
    })
  },
  methods: {
    setrole (userId, roleId) {
      var roleMsg = {
        userId: userId,
        roleId: roleId,
        token: global.getToken()
      }
      var self = this
      axios.get(global.baseUrl + 'userManage/role?' + global.getHttpData(roleMsg))
      .then((res) => {
        // console.log(res)
        if (res.data.callStatus === 'SUCCEED') {
          global.success(self, '操作成功', '')
          self.getUserList(self.userArgs)
        }
      })
    },
    getUserList (args) {
      var self = this
      axios.get(global.baseUrl + 'userManage/list?' + global.getHttpData(args))
      .then((res) => {
        for (let i in res.data.data) {
          res.data.data[i].roleId = parseInt(res.data.data[i].roleId)
        }
        self.userlist = res.data.data
        self.userArgs.currentPage = res.data.currentPage
        self.userArgs.totalPage = res.data.totalPage
      })
    },
    // 分页
    currentPageChange (value) {
      this.userArgs.currentPageChange = value
      this.getUserList(this.userArgs)
    }
  }
}
</script>

<style media="screen">
.cell{
  text-align: center;
}
.testUser{
  text-align: center;
}
.userTitle{
  border-radius: 6px;
  background-color: rgb( 229, 229, 229 );
  height: 60px;
  line-height: 60px;
  font-size: 16px;
}
.userlist{
  height: 60px;
  line-height: 60px;
  font-size: 14px;
}
.userlist .el-col{
  border-right: 1px solid #dfe6ec;
  border-bottom: 1px solid #dfe6ec;
}
.userlist .el-col:first-child{
  border-left: 1px solid #dfe6ec;
}
</style>
